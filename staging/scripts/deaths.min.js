deaths("https://api.coronavirus.data.gov.uk/v1/data?"+"filters=areaType=nation;areaName=england&"+"structure={"+'"date":"date",'+'"newDeaths28DaysByDeathDateAgeDemographics":"newDeaths28DaysByDeathDateAgeDemographics"'+"}");async function deaths(e){const t=await fetch(e);const a=await t.json();const l=a.data.reverse();console.log(l);const o=[];let r=[];let h=[];let s=[];let n=[];let g=[];let c=[];let u=[];let i=[];let p=[];let f=[];let d=[];let D=[];let k=[[],[],[],[],[],[],[],[]];let B=[[],[],[],[],[],[],[],[]];let w=[[],[],[],[],[],[],[],[]];let S=[[],[],[]];let A=[[],[],[],[],[],[],[]];let y=[[],[],[],[],[],[],[]];let m=[[],[],[],[],[],[],[]];let b;let L=baseArrAv();let v=baseArrAv();let C=baseArrAv();let T=baseArrAv();for(let a=0;a<l.length;a++){const q=new Date(l[a].date);if(q>new Date("2020-03-01")){o.push(q.getDate()+"-"+(q.getMonth()+1));for(let t=0;t<l[a].newDeaths28DaysByDeathDateAgeDemographics.length;t++){for(let e=0;e<ageBrackets.length;e++){if(l[a].newDeaths28DaysByDeathDateAgeDemographics[t].age===ageBrackets[e]){L[e].push(l[a].newDeaths28DaysByDeathDateAgeDemographics[t].deaths);v[e].push(l[a].newDeaths28DaysByDeathDateAgeDemographics[t].rollingRate)}}}}}for(let e=0;e<ageBrackets.length;e++){T[e]=doAvg(L[e],T[e])}for(let t=0;t<T[0].length;t++){r[t]=0;for(let e=0;e<=11;e++){r[t]+=T[e][t]}}for(let t=30;t<r.length;t++){s.push((r[t]/r[t-7]-1)*100);for(let e=12;e<=18;e++){y[e-12].push((T[e][t]/T[e][t-7]-1)*100)}}for(let t=s.length-howLongBack;t<s.length;t++){g.push(s[t]);for(let e=0;e<7;e++){A[e].push(y[e][t])}}for(let e=o.length-howLongBack;e<o.length;e++){n.push(o[e])}for(let e=0;e<g.length;e++){S[0].push((A[0][e]+A[1][e])/2);S[1].push((A[2][e]+A[3][e])/2);S[2].push((A[4][e]+A[5][e]+A[6][e])/3)}for(let t=v[0].length-howLongBack;t<v[0].length;t++){for(let e=0;e<v.length;e++){C[e].push(v[e][t])}}console.log(v);for(let a=0;a<T[0].length;a++){let t=0;for(let e=0;e<T.length;e++){t=t+T[e][a]}D.push(t)}for(let l=0;l<8;l++){if(l===0){for(let a=0;a<T[l].length;a++){let t=0;for(let e=0;e<12;e++){t=t+T[e][a]}w[l].push(t/D[a]*100)}}else{for(let e=0;e<T[l].length;e++){w[l].push(T[l+11][e]/D[e]*100)}}}const q=[];for(let e=0;e<8;e++){if(e===0)q.push(r);else q.push(T[e+11])}let W=7;for(let a=0;a<q[0].length;a++){for(let t=0;t<8;t++){let e=getHalfRate(q[t][a],q[t][a-W],W);k[t].push(e)}}for(let a=k[0].length-howLongBack;a<k[0].length;a++){for(let t=0;t<k.length;t++){let e=0;if(Math.abs(k[t][a])>70){e=null}else{e=Math.round(k[t][a]*10)/10}B[t].push(e)}}w.reverse();for(let e=0;e<8;e++){let t,a=[];if(e===0)t=r;else t=T[e+11];for(let e=t.length-howLongBack;e<t.length;e++){a.push(t[e])}m[e]=a}let U=[...k];let x=[...k];for(let t=0;t<B.length;t++){for(let e=0;e<B[t].length;e++){console.log(B[t][e]);console.log(t+","+e);if(B[t][e]>0){x[t][e]=null}else if(B[t][e]<0){U[t][e]=null}console.log(U[t][e]);console.log(x[t][e])}}for(let e=0;e<8;e++){if(e===0)b=r;else b=T[e+11];h.push(dataSet(ageBracketsUpper[e],"rgba(0, 0, 0, 0)",chartColours[darkmode][colourSequence][1][e],b,"line"));if(e===0)b=g;else b=A[e-1];c.push(dataSet(ageBracketsUpper[e],"rgba(0, 0, 0, 0)",chartColours[darkmode][colourSequence][1][e],b,"line"));d.push(dataSet(ageBracketsUpper[e],"rgba(0, 0, 0, 0)",chartColours[darkmode][colourSequence][1][e],B[e],"line"));p.push(dataSet(ageBracketsUpper[e],"rgba(0, 0, 0, 0)",chartColours[darkmode][colourSequence][1][e],m[e],"line"));i.push(dataSet(ageBracketsUpper[7-e],chartColours[darkmode][colourSequence][1][7-e],"#000000",w[e],"bar"))}console.log(C);for(let e=0;e<ageBrackets.length;e++){f.push(dataSet(ageBracketsDisplay[e],"rgba(0, 0, 0, 0)",chartColours[darkmode][colourSequence][0][e],C[e],"line"))}for(let e=0;e<4;e++){if(e===0)b=g;else b=S[e-1];u.push(dataSet(ageBracketsUpperLarge[e],"rgba(0, 0, 0, 0)",chartColours[darkmode][colourSequence][3][e],b,"line"))}chartWithTag("dailyDeaths","line",o,h);chartWithTag("deathsChange","line",n,c);chartWithTag("avgDeathsShort","line",n,p);chartWithTag("deathsChangeBands","line",n,u);chartWithTag("deathsChangeHalf","line",n,d);chartWithTag("deathsPer100000","line",n,f);chartWithTag("deathsProportionChart","bar",o,i,{scales:{xAxes:[{stacked:true}],yAxes:[{stacked:true,ticks:{beginAtZero:true,min:0,max:100}}]}});valReturnSet([["howLongBack1",howLongBack.toString()],["howLongBack2",howLongBack.toString()],["howLongBack3",howLongBack.toString()],["howLongBack4",howLongBack.toString()]])}